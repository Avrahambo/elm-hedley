"use strict";function waitForElement(e,r,a){setTimeout(function(){var n=r.call(null,e,a);n||waitForElement(e,r,a)},50)}function mapManager(e,r){if(!r.leaflet.showMap)return!0;var a=document.querySelector(e);if(!a)return!1;mapEl=mapEl||addMap();var n=JSON.parse(JSON.stringify(r.events)),o=void 0;if(r.leaflet.markers.forEach(function(e){var a=e.id;markersEl[a]?markersEl[a].setLatLng([e.lat,e.lng]):(markersEl[a]=L.marker([e.lat,e.lng]).addTo(mapEl),selectMarker(markersEl[a],a));var l=!!r.leaflet.selectedMarker&&r.leaflet.selectedMarker===a;l&&(o=markersEl[a]),markersEl[a].setIcon(l?selectedIcon:defaultIcon);var t=n.indexOf(a);n.splice(t,1)}),r.leaflet.markers.length){try{mapEl.getBounds()}catch(l){mapEl.fitBounds(r.leaflet.markers)}o?mapEl.panTo(o._latlng):mapEl.fitBounds(r.leaflet.markers)}else mapEl.setZoom(1);n.forEach(function(e){markersEl[e]&&(mapEl.removeLayer(markersEl[e]),markersEl[e]=void 0)});for(var t in markersEl)r.events.indexOf(parseInt(t))>-1||markersEl[t]&&(mapEl.removeLayer(markersEl[t]),markersEl[t]=void 0);return!0}function selectMarker(e,r){e.on("click",function(e){elmApp.ports.selectEvent.send(r)})}function addMap(){var e=L.map("map");return L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6IjZjNmRjNzk3ZmE2MTcwOTEwMGY0MzU3YjUzOWFmNWZhIn0.Y8bhBaUMqFiPrDRW9hieoQ",{maxZoom:10,id:"mapbox.streets"}).addTo(e),e}function attachDropzone(e,r){if("Article"!=r.activePage)return!1;var a=document.querySelector(e);if(!a)return!1;if(dropZone)return clearedDropzone||"Done"!=r.postStatus||(dropZone.removeAllFiles(!0),clearedDropzone=!0),!0;var n=r.backendUrl+"/api/file-upload?access_token="+r.accessToken;dropZone=new Dropzone(e,{url:n}),dropZone.on("sending",function(e){}),dropZone.on("complete",function(e){if(e.accepted&&200===e.xhr.status){var r=JSON.parse(e.xhr.response),a=parseInt(r.data[0].id);elmApp.ports.dropzoneUploadedFile.send(a)}})}var initialValues={dropzoneUploadedFile:null,selectEvent:null},elmApp=Elm.fullscreen(Elm.Main,initialValues),mapEl=void 0,markersEl={},defaultIcon=L.icon({iconUrl:"default@2x.5859992f.png",iconRetinaUrl:"default@2x.5859992f.png",iconSize:[35,46]}),selectedIcon=L.icon({iconUrl:"selected@2x.c4402371.png",iconRetinaUrl:"selected@2x.c4402371.png",iconSize:[35,46]});elmApp.ports.mapManager.subscribe(function(e){return!e.leaflet.showMap&&mapEl?(mapEl.remove(),mapEl=void 0,void(markersEl={})):void waitForElement("#map",mapManager,e)});var dropZone=void 0,clearedDropzone=!1;elmApp.ports.activePage.subscribe(function(e){return"Article"!=e.activePage?(dropZone=void 0,void(clearedDropzone=!1)):void waitForElement(".dropzone",attachDropzone,e)});